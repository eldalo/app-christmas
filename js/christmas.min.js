"use strict";function resizeGame(){setTimeout(function(){$("#game").show(),$("#game").width($(window).width()),$("#game").height($(window).height())},200)}function initLoad(){_game=new Phaser.Game(1170,200,Phaser.Auto,"christmas",null,(!0)),_game.global={loaderFile:"assets.json?"+Math.random(),assetsJSON:null,homeUtils:{},iPoints:"",uPoints:function(){console.log("uPoints")}},_game.state.add("Boot",_preload.boot),_game.state.add("Preloader",_preload.preloader),_game.state.add("Home",_main.christmas),_game.state.start("Boot"),resizeGame()}var _game=null,_main={},_preload={};_preload.boot=function(){this.firstRunPortrait=!1},_preload.boot.prototype={init:function(){this.input.maxPointers=1,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinWidth=315,this.scale.setMinHeight=200,this.scale.setMaxWidth=1170,this.scale.setMaxHeight=200,this.time.desiredFps=50,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.stage.disableVisibilityChange=!0,this.stage.backgroundColor="#6da2af",this.transparent=!0,this.stage.smoothed=!0},preload:function(){this.load.path="assets/",this.load.json("assets","assets.json",_game.rnd.integer())},create:function(){_game.global.assetsJSON=_game.cache.getJSON("assets")},update:function(){(_game.device.desktop||_game.scale.isLandscape)&&_game.state.start("Preloader")}},_preload.preloader=function(){this.preloadText=null},_preload.preloader.prototype={init:function(){this.preloadText=this.add.text(this.world.centerX,this.world.centerY,"Cargando: 0%",{align:"center",font:"20px Arcade",fill:"#0000"}),this.preloadText.anchor.x=.5,this.preloadText.anchor.y=.5},preload:function(){this.load.path="assets/";var e=_game.global.assetsJSON.sprites,t=_game.global.assetsJSON.audio,i=_game.global.assetsJSON.images,s="?"+Math.random().toString();if(t.length)for(var a=t.length-1;a>=0;a--)this.load.audio(t[a].name,t[a].path+s);if(i.length)for(var o=i.length-1;o>=0;o--)this.load.image(i[o].name,i[o].path+s);if(e.length)for(var n=e.length-1;n>=0;n--){var l=parseInt(e[n].width),h=parseInt(e[n].height);this.load.spritesheet(e[n].name,e[n].path+s,l,h)}this.load.spritesheet("nutcracker","spritesheet/_nutcracker.png",24,62),this.load.onFileComplete.add(this.fileComplete,this),this.load.onLoadComplete.add(this.fileComplete,this)},loadComplete:function(){this.load.onFileComplete.add(this.fileComplete,this),this.load.onLoadComplete.add(this.fileComplete,this)},fileComplete:function(e){this.preloadText.text="Cargando "+e+"%"},loadUpdate:function(){},create:function(){this.state.start("Home")}},_main.christmas=function(){this.config={background:null,controls:null,play:!1,time:0,timeRange:[1e3,4500],acceleration:15,speed:75,maxSpeed:1e3},this.texts={endGame:null,hi:null,score:null,defaultScore:{}},this.tree=null,this.treeItems=[],this.player=null,this.mountains={sprite:null,speed:1,maxSpeed:15,acceleration:.5},this.snow=null,this.score=0,this.floor=null,this.btnPlay=null,this.btnReload=null},_main.christmas.prototype={init:function(){this.config.play=!1,this.treeItems=[0,1,2],this.texts.defaultScore={font:"16px Arcade",fill:"#3c3c3c",align:"right"},this.physics.startSystem(Phaser.Physics.NINJA),this.physics.ninja.setBoundsToWorld(),this.physics.ninja.gravity=1},showResetConfig:function(){this.config.time=0,this.config.speed=75,this.score=0,this.config.play=!0},showPlay:function(){this.player.animations.play("run"),this.btnPlay.destroy(),this.texts.score=_game.add.text(_game.world.width-100,_game.world.top+5,"SCORE  0",this.texts.defaultScore),this.texts.hi=_game.add.text(this.texts.score.x-this.texts.score.width-5,_game.world.top+5,"HI  0",this.texts.defaultScore),this.config.play=!0},showReload:function(){this.texts.hi.text="HI  "+this.score,this.tree.destroy(!0),this.player.animations.play("run"),this.btnReload.destroy(),this.texts.endGame.destroy(),this.createTree(),this.showResetConfig()},showControls:function(){this.player.body.velocity.setTo(0,0),this.config.controls.duration<150&&this.config.controls.isDown?(this.player.body.moveUp(350),this.player.animations.play("up")):this.player.animations.play("run")},createNutcracker:function(){this.player=_game.add.sprite(100,_game.world.bottom-47,"nutcracker"),this.physics.ninja.enable(this.player),this.player.body.bounce=.1,this.player.body.friction=.5,this.player.body.collideWorldBounds=!0,this.player.body.checkCollision.up=!0,this.player.body.checkCollision.down=!0,this.player.body.checkCollision.left=!1,this.player.anchor.setTo(.5,.5),this.player.animations.add("up",[0],15,!1),this.player.animations.add("run",[1,2],10,!0)},createFloor:function(){var e=this.game.width,t=24,i=this.add.bitmapData(e,t);i.ctx.fillStyle="#9ed4d5",i.ctx.beginPath(),i.ctx.rect(0,0,e,t),i.ctx.fill(),this.floor=this.add.sprite(0,this.game.height-t,i),this.physics.ninja.enableTile(this.floor,1)},createTree:function(){this.tree=_game.add.group(),this.tree.name="tree",this.tree.enableBody=!0,this.tree.physicsBodyType=Phaser.Physics.NINJA,this.tree.createMultiple(1,"tree"),this.tree.setAll("outOfBoundsKill",!0),this.tree.setAll("body.collideWorldBounds",!0)},createSnow:function(){this.snow=_game.add.group(),this.snow.name="snow",this.tree.enableBody=!0,this.tree.physicsBodyType=Phaser.Physics.NINJA,this.tree.createMultiple(1,"snow"),this.tree.setAll("outOfBoundsKill",!0),this.tree.setAll("body.collideWorldBounds",!0)},impactTree:function(e,t){this.player.animations.stop(),this.updateTreeSpeed(!0),this.btnReload=_game.add.button(_game.world.centerX,_game.world.centerY,"reload",this.showReload,this,2,1,0),this.texts.endGame=_game.add.text(_game.world.centerX-15,_game.world.centerY-35,"END GAME",{font:"20px Arcade",fill:"#3c3c3c"}),this.config.play=!1},generateTree:function(){var e=this.treeItems[_game.rnd.integerInRange(0,this.treeItems.length-1)],t=_game.world.height,i=null,s=2150,a=null;switch(e){case 0:i="big",t-=71;break;case 1:i="double",t-=55;break;case 2:i="small",t-=55}a=this.tree.create(_game.width,t-30,i),this.physics.ninja.enable(a),a.body.bounce=0,a.body.friction=0,a.checkWorldBounds=!0,a.body.collideWorldBounds=!1,a.body.moveLeft(this.config.speed),a.events.onOutOfBounds.add(function(e){e.filters=null},this),a.events.onKilled.add(function(e){e.filters=null},this),this.score>500?s=1750:this.score>1e3?s=1250:this.score>1500?s=750:this.score>2e3&&(s=250),s<this.config.speed&&(s=this.config.speed+500),this.config.time=_game.time.now+s-this.config.speed},generateSnow:function(){var e=_game.rnd.integerInRange(0,_game.width),t=this.snow.create(e,0,"snow");this.physics.ninja.enable(t),t.body.bounce=0,t.body.friction=0,t.checkWorldBounds=!0,t.body.collideWorldBounds=!1,t.body.gravity=!0,t.events.onOutOfBounds.add(function(e){e.filters=null},this)},updateSpeed:function(){this.config.speed<this.config.maxSpeed&&(this.config.speed+=this.config.acceleration),this.mountains.speed<this.mountains.maxSpeed&&(this.mountains.speed+=this.mountains.acceleration),this.updateTreeSpeed(!1)},updateTreeSpeed:function(e){this.tree.forEach(function(t){e?t.kill():t.body.moveLeft(this.config.speed)},this)},create:function(){_game.physics.arcade.gravity.y=7500,this.config.controls=_game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.config.background=_game.add.tileSprite(0,0,_game.stage.width,_game.cache.getImage("gameBackground").height,"gameBackground"),this.btnPlay=_game.add.button(_game.world.centerX,_game.world.centerY,"play",this.showPlay,this,2,1,0),this.mountains.sprite=_game.add.tileSprite(0,_game.height-_game.cache.getImage("mountains").height-24,_game.stage.width,_game.cache.getImage("mountains").height,"mountains"),this.mountains.sprite.scale.set(1.13),this.createNutcracker(),this.createTree(),this.createSnow(),this.createFloor()},update:function(){_game.physics.ninja.collide(this.tree,this.floor),_game.physics.ninja.collide(this.player,this.floor),this.config.play&&(this.mountains.sprite.tilePosition.x-=1,this.showControls(),this.generateSnow(),_game.time.now>this.config.time&&(this.generateTree(),this.updateSpeed()),this.texts.score.text="SCORE  "+this.score,this.score++,_game.physics.ninja.collide(this.tree,this.player,this.impactTree,null,this))}},$(window).on("load",initLoad);